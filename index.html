<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ–°åŒ—å¸‚-å¤©æ°£é å ±</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: "Noto Sans TC", sans-serif;
      background: linear-gradient(to top, #a1c4fd, #c2e9fb);
      overflow-x: hidden;
      color: #333;
      display: flex;
      flex-direction: column;
    }

    /* é›²æœµå®¹å™¨åœ¨èƒŒæ™¯ */
    #cloudContainer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0; /* ç¢ºä¿åœ¨å…§å®¹ä¸‹é¢ */
    }

    #mainContent {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: stretch;
      overflow: hidden;
      padding: 20px 100px;
      gap: 20px;
      z-index: 1;
    }

    /* é£„å‹•é›²æœµ */
    .cloud {
      position: absolute;
      background: radial-gradient(circle at 50% 50%, #fff 60%, transparent 100%);
      border-radius: 50%;
      opacity: 0.7;
      pointer-events: none;
      transform: translate3d(0,0,0);
    }

    @keyframes floatCloud {
      0% { transform: translateX(-250px); }
      100% { transform: translateX(120vw); }
    }

    header {
      background: rgba(255,255,255,0.3);
      backdrop-filter: blur(12px);
      color: #333;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid rgba(255,255,255,0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-radius: 0 0 16px 16px;
    }

    .header-left {
      font-size: 20px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .header-right {
      text-align: right;
      font-size: 13px;
      opacity: 0.9;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
    }

    .today, .others {
      flex: 1 1 400px;
      background: rgba(255,255,255,0.85);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0px 6px 22px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease forwards;
      transition: transform 0.3s, box-shadow 0.3s;
      overflow-y: auto;
      max-height: 80vh;
    }

    .today:hover, .others:hover {
      transform: translateY(-5px);
      box-shadow: 0px 12px 30px rgba(0,0,0,0.15);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .city {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .forecast-list {
      display: grid;
      gap: 15px;
    }

    .forecast-card {
      background: rgba(255,255,255,0.95);
      padding: 15px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
      overflow: hidden;
      animation: slideUp 0.8s ease forwards;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .forecast-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .temp {
      font-size: 16px;
      font-weight: bold;
    }

    #loading {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      color:#4a90e2;
      font-weight:bold;
      z-index:9999;
      flex-direction: column;
      gap: 12px;
    }

    .spinner {
      width:50px;
      height:50px;
      border:5px solid #c9d6e8;
      border-top-color:#4a90e2;
      border-radius:50%;
      animation:spin 1s linear infinite;
    }

    @keyframes spin { from {transform:rotate(0);} to {transform:rotate(360deg);} }

    /* RWD */
    @media (max-width: 768px) {
      .header-left { font-size: 18px; }
      .header-right { font-size: 12px; }
      .today, .others { flex: 1 1 100%; max-height: none; }
      #mainContent { padding: 20px; gap: 10px; }
    }

    @media (max-width: 480px) {
      .header-left { font-size: 16px; }
      .header-right { font-size: 11px; }
      .city { font-size: 20px; }
      .temp { font-size: 14px; }
      .forecast-card { padding: 12px 10px; gap: 5px; }
    }
  </style>
</head>
<body>
  <div id="cloudContainer"></div>

  <header>
    <div class="header-left" id="headerCity">-</div>
    <div class="header-right">
      <div class="header-date" id="headerDate">-</div>
    </div>
  </header>

  <div id="mainContent" class="container">
    <div class="today">
      <div class="city" id="city"></div>
      <div class="update-time" id="updateTime"></div>
      <div id="todayForecast"></div>
    </div>

    <div class="others">
      <h3>æ¥ä¸‹ä¾†çš„å¤©æ°£</h3>
      <div class="forecast-list" id="forecastList"></div>
    </div>
  </div>

  <div id="loading">
    <div class="spinner"></div>
    <span>è¼‰å…¥ä¸­...</span>
  </div>

  <script>
    function formatDateTime(date) {
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hour = date.getHours();
      const min = date.getMinutes();
      const days = ["é€±æ—¥","é€±ä¸€","é€±äºŒ","é€±ä¸‰","é€±å››","é€±äº”","é€±å…­"];
      const weekday = days[date.getDay()];
      return { time: `${hour}:${min < 10 ? '0'+min : min}`, date: `${year}/${month}/${day} ${weekday}` };
    }

    function getWeatherIcon(weather) {
      if (!weather) return "ğŸŒ¤ï¸";
      if (weather.includes("æ™´")) return "â˜€ï¸";
      if (weather.includes("å¤šé›²")) return "â›…";
      if (weather.includes("é™°")) return "â˜ï¸";
      if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
      if (weather.includes("é›·")) return "â›ˆï¸";
      return "ğŸŒ¤ï¸";
    }

    function getTempColor(temp) {
      const t = parseInt(temp);
      if (t <= 18) return '#1E90FF';
      if (t <= 24) return '#32CD32';
      if (t <= 30) return '#FFA500';
      return '#FF4500';
    }

    function createCloud(top, size, duration, opacity, zIndex) {
      const cloud = document.createElement('div');
      cloud.className = 'cloud';
      cloud.style.width = `${size}px`;
      cloud.style.height = `${size*0.5}px`;
      cloud.style.top = `${top}px`;
      cloud.style.animation = `floatCloud ${duration}s linear infinite`;
      cloud.style.opacity = opacity;
      cloud.style.zIndex = zIndex;
      cloud.style.transform = `scale(${0.7 + Math.random()*0.6})`;
      return cloud;
    }

    function generateInitialClouds() {
      const container = document.getElementById('cloudContainer');
      for(let i=0;i<8;i++){
        const cloud = createCloud(
          Math.random() * (window.innerHeight - 100),
          Math.random()*120+60,
          Math.random()*60+40,
          Math.random()*0.5+0.5,
          Math.floor(Math.random()*10)
        );
        container.appendChild(cloud);
      }
    }

    async function loadWeather() {
      try {
        const res = await fetch("https://oo-cwaweather-backend.zeabur.app/api/weather/kaohsiung");
        const json = await res.json();
        const data = json.data;

        document.getElementById("city").textContent = data.city;
        document.getElementById("updateTime").textContent = data.updateTime;
        document.getElementById("headerCity").textContent = `${data.city}`;

        const dt = formatDateTime(new Date());
        document.getElementById("headerDate").textContent = dt.date;

        const today = data.forecasts[0];
        const todayMin = today.minTemp.replace('Â°C','');
        const todayMax = today.maxTemp.replace('Â°C','');
        const todayIcon = getWeatherIcon(today.weather);
        document.getElementById('todayForecast').innerHTML = `
          <div class="forecast-card">
            <div class="time-range">${today.startTime} ~ ${today.endTime}</div>
            <div><span class="label">å¤©æ°£ï¼š</span>${todayIcon} ${today.weather}</div>
            <div><span class="label">é™é›¨æ©Ÿç‡ï¼š</span>${today.rain}</div>
            <div class="temp" style="color:${getTempColor(todayMax)}">ğŸŒ¡ ${todayMin}Â°C - ${todayMax}Â°C</div>
            <div><span class="label">é«”æ„Ÿï¼š</span>${today.comfort}</div>
          </div>
        `;

        const list = document.getElementById('forecastList');
        list.innerHTML = '';
        data.forecasts.slice(1).forEach(f => {
          const min = f.minTemp.replace('Â°C','');
          const max = f.maxTemp.replace('Â°C','');
          const icon = getWeatherIcon(f.weather);
          const card = document.createElement('div');
          card.className = 'forecast-card';
          card.innerHTML = `
            <div class="time-range">${f.startTime} ~ ${f.endTime}</div>
            <div><span class="label">å¤©æ°£ï¼š</span>${icon} ${f.weather}</div>
            <div><span class="label">é™é›¨æ©Ÿç‡ï¼š</span>${f.rain}</div>
            <div class="temp" style="color:${getTempColor(max)}">ğŸŒ¡ ${min}Â°C - ${max}Â°C</div>
            <div><span class="label">é«”æ„Ÿï¼š</span>${f.comfort}</div>
          `;
          list.appendChild(card);
        });

        document.getElementById('loading').style.display = 'none';

        for(let i=0;i<10;i++){
          const cloud = createCloud(
            Math.random() * (window.innerHeight - 100),
            Math.random()*120+60,
            Math.random()*60+40,
            Math.random()*0.5+0.5,
            Math.floor(Math.random()*10)
          );
          document.getElementById('cloudContainer').appendChild(cloud);
        }

      } catch(err) {
        console.error("è¼‰å…¥å¤©æ°£è³‡æ–™å¤±æ•—", err);
        document.getElementById('loading').textContent = 'è¼‰å…¥å¤±æ•—';
      }
    }

    generateInitialClouds();
    loadWeather();
  </script>
</body>
</html>
